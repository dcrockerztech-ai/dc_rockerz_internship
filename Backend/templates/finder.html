<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Internship Finder</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #61d3e8;
      --secondary-color: #5a75f1;
      --background-start: #f8fcff;
      --background-end: #e2f2ff;
      --text-dark: #1f2937;
      --text-muted: #6b7280;
    }

    html,
    body {
      overscroll-behavior: none; /* disables scroll bounce */
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, var(--background-start), var(--background-end));
      min-height: 100vh;
      color: var(--text-dark);
      margin: 0;
      padding: 24px;
    }

    .crystal-card {
      background: rgba(255, 255, 255, 0.4);
      backdrop-filter: blur(30px);
      border: 1px solid rgba(255, 255, 255, 0.6);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    .crystal-input {
      background: rgba(255, 255, 255, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.8);
      color: var(--text-dark);
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .crystal-input:focus {
      outline: none;
      border-color: var(--primary-color);
    }

    .crystal-chip {
      background: rgba(255, 255, 255, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.8);
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      color: var(--text-dark);
    }

    .crystal-chip.selected {
      background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
      border-color: transparent;
      box-shadow: 0 4px 10px rgba(97, 211, 232, 0.4);
      color: white;
    }

    .crystal-radio label {
      border: 1px solid rgba(255, 255, 255, 0.8);
      transition: all 0.3s ease;
    }

    .crystal-radio input:checked+label {
      background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
      border-color: transparent;
      color: white;
      box-shadow: 0 4px 10px rgba(97, 211, 232, 0.4);
    }

    .crystal-btn {
      background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
      box-shadow: 0 5px 15px rgba(97, 211, 232, 0.4);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .crystal-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(97, 211, 232, 0.6);
    }
  </style>
</head>

<body>
  <header class="text-center mb-8">
    <h1 class="text-4xl sm:text-5xl font-bold mb-2">Internship Finder</h1>
    <p class="text-base sm:text-lg text-gray-500">Your portal to a seamless career experience.</p>
  </header>

  <main class="w-full max-w-4xl mx-auto">
    <!-- Form Card -->
    <div class="p-8 rounded-3xl crystal-card w-full">
      <h2 class="text-2xl font-semibold mb-6 text-gray-800">Refine Your Search</h2>
      <form id="recommendation-form" class="space-y-6">
        <div>
          <label class="block font-semibold mb-2 text-gray-700">Highest Education</label>
          <select id="education" name="education" class="w-full p-4 rounded-xl crystal-input transition-colors">
            <option value="Class 12th">Class 12th</option>
            <option value="Graduate" selected>Graduate</option>
          </select>
        </div>

        <div>
          <label class="block font-semibold mb-2 text-gray-700">Skills You Know</label>
          <div class="flex flex-wrap gap-2" id="skillsChips">
            <div class="p-3 px-5 rounded-full cursor-pointer select-none crystal-chip transition-colors"
              data-value="communication">Communication</div>
            <div class="p-3 px-5 rounded-full cursor-pointer select-none crystal-chip transition-colors"
              data-value="data collection">Data Collection</div>
            <div class="p-3 px-5 rounded-full cursor-pointer select-none crystal-chip transition-colors"
              data-value="problem solving">Problem Solving</div>
            <div class="p-3 px-5 rounded-full cursor-pointer select-none crystal-chip transition-colors"
              data-value="basic it">Basic IT</div>
          </div>
        </div>

        <div>
          <label class="block font-semibold mb-2 text-gray-700">Sector of Interest</label>
          <div class="flex flex-wrap gap-3 crystal-radio">
            <input class="hidden" type="radio" id="sector-it" name="sector" value="IT" checked>
            <label for="sector-it"
              class="p-4 px-6 rounded-xl cursor-pointer flex-1 text-center transition-colors">ðŸ’» IT</label>
            <input class="hidden" type="radio" id="sector-edu" name="sector" value="Education">
            <label for="sector-edu"
              class="p-4 px-6 rounded-xl cursor-pointer flex-1 text-center transition-colors">ðŸ“š Education</label>
            <input class="hidden" type="radio" id="sector-fin" name="sector" value="Finance">
            <label for="sector-fin"
              class="p-4 px-6 rounded-xl cursor-pointer flex-1 text-center transition-colors">ðŸ’° Finance</label>
          </div>
        </div>

        <div>
          <label class="block font-semibold mb-2 text-gray-700">Preferred Location</label>
          <select id="location" name="location" class="w-full p-4 rounded-xl crystal-input transition-colors">
            <option value="Urban">Urban</option>
            <option value="Semi-Urban">Semi-Urban</option>
            <option value="Rural">Rural</option>
          </select>
        </div>

        <button type="submit" class="w-full p-4 rounded-xl font-bold uppercase text-white crystal-btn">
          Find Internships
        </button>
        <div id="loading" class="mt-4 italic text-center text-sm text-gray-500" style="display:none">Searching...</div>
        <div id="error" class="mt-4 italic text-center text-red-500 font-bold text-sm" style="display:none"></div>
      </form>
    </div>

    <!-- Results Section -->
    <div id="results" class="mt-8"></div>
  </main>

  <script>
    (function () {
      const API_BASE = window.location.origin;
      const ENDPOINT = API_BASE + '/recommend';

      const form = document.getElementById('recommendation-form');
      const loadingEl = document.getElementById('loading');
      const errorEl = document.getElementById('error');
      const resultsEl = document.getElementById('results');
      const chips = document.getElementById('skillsChips');

      chips.addEventListener('click', (ev) => {
        const chip = ev.target.closest('.crystal-chip');
        if (!chip) return;
        chip.classList.toggle('selected');
      });

      function getSelectedSkills() {
        return Array.from(document.querySelectorAll('.crystal-chip.selected')).map(c => c.dataset.value);
      }

      function getSelectedSector() {
        const r = document.querySelector('input[name="sector"]:checked');
        return r ? r.value : '';
      }

      function showLoading(on) { loadingEl.style.display = on ? 'block' : 'none'; }
      function showError(msg) { errorEl.style.display = msg ? 'block' : 'none'; errorEl.textContent = msg || ''; }

      function renderResults(list) {
        resultsEl.innerHTML = '';
        if (!list || list.length === 0) {
          resultsEl.innerHTML =
            '<div class="p-6 rounded-3xl crystal-card"><p class="text-center text-gray-500">No internships found.</p></div>';
          return;
        }
        list.forEach(job => {
          const div = document.createElement('div');
          div.className = 'p-6 rounded-3xl mb-4 crystal-card transition-transform hover:scale-[1.01]';
          const title = job.title || job.name || 'Untitled Internship';
          const company = job.company || job.company_name || 'Unknown Corporation';
          const skills = job.skills || job.required_skills || [];
          const locs = job.expanded_locations || job.eligible_locations || job.location || 'Unknown Location';
          const stipend = job.stipend ? (' | â‚¹' + job.stipend) : '';

          div.innerHTML = `
            <div class="flex justify-between items-start mb-2">
              <div>
                <strong class="text-xl text-gray-800 font-semibold">${escapeHtml(title)}</strong>
                <div class="text-sm text-gray-500 mt-1">${escapeHtml(company)}${stipend}</div>
              </div>
            </div>
            <div class="text-xs text-gray-500 mt-2">Location: ${escapeHtml(locs)}</div>
            <div class="flex flex-wrap gap-2 mt-4">
              ${(skills || []).toString().split(',').filter(Boolean).map(s => '<span class="px-3 py-1 rounded-full text-xs text-cyan-700 bg-cyan-100">' + escapeHtml(s.trim()) + '</span>').join('')}
            </div>
          `;
          resultsEl.appendChild(div);
        });
      }

      function escapeHtml(s) {
        return String(s || '').replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
      }

      async function fetchWithTimeout(url, options = {}, timeout = 15000) {
        const controller = new AbortController();
        const id = setTimeout(() => controller.abort(), timeout);
        try {
          const res = await fetch(url, Object.assign({}, options, { signal: controller.signal }));
          clearTimeout(id);
          return res;
        } catch (err) {
          clearTimeout(id);
          throw err;
        }
      }

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        showError('');
        resultsEl.innerHTML = '';
        showLoading(true);

        const payload = {
          education: document.getElementById('education').value || '',
          skills: getSelectedSkills(),
          interests: [],
          sector: getSelectedSector(),
          location: document.getElementById('location').value || ''
        };

        try {
          const res = await fetchWithTimeout(ENDPOINT, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          }, 15000);

          if (!res.ok) throw new Error('SERVER_ERROR: ' + res.status);

          const data = await res.json().catch(() => null);
          renderResults(Array.isArray(data) ? data : (data && data.results ? data.results : []));
        } catch (err) {
          showError(err.message || 'Data call failed.');
        } finally {
          showLoading(false);
        }
      });
    })();
  </script>
</body>

</html>
